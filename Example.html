<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="Python">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Examples &#8212; Zacros Wrapper 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Compiling modified Zacros executable" href="compile_zacros.html" />
    <link rel="prev" title="Python wrapper for the Zacros kinetic Monte Carlo (KMC) code" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="compile_zacros.html" title="Compiling modified Zacros executable"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Python wrapper for the Zacros kinetic Monte Carlo (KMC) code"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Zacros Wrapper 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<p>We look at the examples in the &#8216;examples&#8217; folder of the Github repository. For all scripts, the user must configure
the parameters (mostly directories) at the top of the script under the &#8220;User input&#8221; section.</p>
<div class="section" id="converting-dft-data-to-zacros-input-files">
<h2>Converting DFT data to Zacros input files<a class="headerlink" href="#converting-dft-data-to-zacros-input-files" title="Permalink to this headline">¶</a></h2>
<p>This script reads VASP data and computes parameters for the input files.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri Apr 07 09:39:17 2017</span>

<span class="sd">@author: wittregr</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">DFT_to_Thermochemistry</span> <span class="kn">as</span> <span class="nn">_thermo</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>

<span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
    <span class="n">Base_path</span> <span class="o">=</span> <span class="s1">&#39;C:\Users\wittregr\Documents\Python Scripts&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">Base_path</span> <span class="o">=</span> <span class="s1">&#39;/home/1729&#39;</span>
<span class="n">Input</span> <span class="o">=</span> <span class="s1">&#39;Input&#39;</span>
<span class="n">Output</span> <span class="o">=</span> <span class="s1">&#39;Output&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> Read reference species and calculate all thermodynamic quantities</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c1">#filepath = os.path.join(Base_path, Input, &#39;Reference_set_info.txt&#39;)</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Base_path</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="s1">&#39;Zacros_Species_Energy.txt&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">lines</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">_thermo</span><span class="o">.</span><span class="n">DFTFileRead</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="n">T_ref</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Base_path</span><span class="p">,</span> <span class="n">Input</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
    <span class="n">T_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_thermo</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd"> Read target species and calculate all thermodynamic quantities</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Base_path</span><span class="p">,</span> <span class="s1">&#39;Input&#39;</span><span class="p">,</span> <span class="s1">&#39;Tobe_Referenced.txt&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">lines</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">_thermo</span><span class="o">.</span><span class="n">DFTFileRead</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="n">T_target</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
    <span class="n">T_target</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_thermo</span><span class="o">.</span><span class="n">Target</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">Base_path</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Create basis set from reference molecules</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">Basis</span> <span class="o">=</span> <span class="n">_thermo</span><span class="o">.</span><span class="n">Reference</span><span class="o">.</span><span class="n">BasisSet</span><span class="p">(</span><span class="n">T_ref</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Read surface slab energy from input file</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Base_path</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="s1">&#39;Surface_energy_data.txt&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">lines</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">_thermo</span><span class="o">.</span><span class="n">DFTFileRead</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
<span class="n">T_surface</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>
    <span class="n">T_surface</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_thermo</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Apply reference molecule correct to thermodynamic data</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">T_target</span> <span class="o">=</span> <span class="n">_thermo</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">ReferenceDFT</span><span class="p">(</span><span class="n">T_target</span><span class="p">,</span> <span class="n">T_surface</span><span class="p">,</span> <span class="n">Basis</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Output thermat file from calculated thermodynamic data</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">T_target</span> <span class="o">=</span> <span class="n">_thermo</span><span class="o">.</span><span class="n">Target</span><span class="o">.</span><span class="n">CreateThermdat</span><span class="p">(</span><span class="n">T_target</span><span class="p">,</span> <span class="n">Base_path</span><span class="p">,</span> <span class="n">Output</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Output Zacros input file from thermodynamic data</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">pass</span>

<span class="sd">&#39;&#39;&#39;</span>


<span class="sd">Test output (To be removed in final version)</span>


<span class="sd">&#39;&#39;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Heat Capacities [kcal/mol K] over a range of Temperatures [k]&#39;</span>
<span class="k">print</span> <span class="s1">&#39;-------------------------------------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Name             &#39;</span><span class="p">,</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Cp_Range</span><span class="p">)):</span>
    <span class="k">print</span> <span class="s1">&#39; </span><span class="si">%4d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Cp_Range</span><span class="p">[</span><span class="n">y</span><span class="p">]),</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="k">print</span> <span class="s1">&#39;---------------- &#39;</span><span class="p">,</span>
<span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Cp_Range</span><span class="p">)):</span>
    <span class="k">print</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;----&#39;</span><span class="p">),</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_target</span><span class="p">)):</span>
    <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%16s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">Cp</span><span class="p">)):</span>
        <span class="k">print</span> <span class="s1">&#39; </span><span class="si">%5.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">Cp</span><span class="p">[</span><span class="n">y</span><span class="p">]),</span>
    <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>

<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Standard Heats of Formation and Dispersion&#39;</span>
<span class="k">print</span> <span class="s1">&#39;------------------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Name               hf(</span><span class="si">%6.2f</span><span class="s1">)    edisp   S(</span><span class="si">%6.2f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Tstp</span><span class="p">,</span>
                                                            <span class="n">T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Tstp</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;----------------   ----------   -------  ---------&#39;</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_target</span><span class="p">)):</span>
    <span class="k">print</span> <span class="s1">&#39;</span><span class="si">%-16s</span><span class="s1">     </span><span class="si">%7.3f</span><span class="s1">    </span><span class="si">%6.3f</span><span class="s1">    </span><span class="si">%6.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                 <span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">hf_Tstp</span><span class="p">,</span>
                                                 <span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">convedisp</span><span class="p">,</span>
                                                 <span class="n">T_target</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">S_Tstp</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="analyzing-a-single-trajectory">
<h2>Analyzing a single trajectory<a class="headerlink" href="#analyzing-a-single-trajectory" title="Permalink to this headline">¶</a></h2>
<p>Single_trajectory.py analyzes a single Zacros trajectory and plots some data.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Read the output for a Zacros trajectory and plot data</span>

<span class="kn">import</span> <span class="nn">zacros_wrapper</span> <span class="kn">as</span> <span class="nn">zw</span>

<span class="sd">&#39;&#39;&#39; ------------ User input section ------------ &#39;&#39;&#39;</span>
<span class="n">RunPath</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/wangyf/Alumina/mechanismI/5&#39;</span>
<span class="sd">&#39;&#39;&#39; -------------------------------------------- &#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39; Read simulation results &#39;&#39;&#39;</span>
<span class="n">my_trajectory</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">kmc_traj</span><span class="p">()</span>                           <span class="c1"># Create single trajectory object</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">RunPath</span>                            <span class="c1"># Set directory for files</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">ReadAllOutput</span><span class="p">(</span><span class="n">build_lattice</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>         <span class="c1"># Read input and output files</span>

<span class="sd">&#39;&#39;&#39; Plot data &#39;&#39;&#39;</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">PlotSurfSpecVsTime</span><span class="p">()</span>                      <span class="c1"># Plot surface species populations versus time</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">PlotGasSpecVsTime</span><span class="p">()</span>                       <span class="c1"># Plot gas species populations versus time</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">PlotElemStepFreqs</span><span class="p">(</span><span class="n">time_norm</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>       <span class="c1"># Plot elementary step frequencies</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">PlotLattice</span><span class="p">()</span>                             <span class="c1"># Plot the lattice</span>
<span class="n">my_trajectory</span><span class="o">.</span><span class="n">LatticeMovie</span><span class="p">()</span>                            <span class="c1"># Plot the lattice snapshots</span>
</pre></div>
</div>
<p>This produces several .png images with data within the folder with the Zacros files.</p>
</div>
<div class="section" id="running-and-analyzing-multiple-trajectories">
<h2>Running and analyzing multiple trajectories<a class="headerlink" href="#running-and-analyzing-multiple-trajectories" title="Permalink to this headline">¶</a></h2>
<p>Multiple_trajectories_MPI.py analyzes multiple trajectories, averages them, computes the rate, and performs sensitivity analysis. MPI is used to parallelize
running the trajectories. Therefore it must be launced with the <code class="docutils literal"><span class="pre">mpiexec</span></code> command.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Read multiple trajectories and perform statistical analysis</span>

<span class="kn">import</span> <span class="nn">zacros_wrapper</span> <span class="kn">as</span> <span class="nn">zw</span>
<span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>

<span class="sd">&#39;&#39;&#39; ------------ User input section ------------ &#39;&#39;&#39;</span>
<span class="n">zacros_exe</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/bin/zacros_ZW.x&#39;</span>
<span class="n">KMC_source</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/Github/Zacros-Wrapper/input_files/AtoB/&#39;</span>
<span class="n">BatchPath</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/test&#39;</span>
<span class="n">Product</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
<span class="n">n_runs</span> <span class="o">=</span> <span class="mi">16</span>
<span class="sd">&#39;&#39;&#39; -------------------------------------------- &#39;&#39;&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">COMM</span> <span class="o">=</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
    <span class="n">COMM</span><span class="o">.</span><span class="n">Barrier</span><span class="p">()</span>

    <span class="c1"># Prepare template</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">Replicates</span><span class="p">()</span>
    <span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">kmc_traj</span><span class="p">()</span>
    <span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">KMC_source</span>
    <span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">exe_file</span> <span class="o">=</span> <span class="n">zacros_exe</span>
    <span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">ReadAllInput</span><span class="p">()</span>
    <span class="n">x</span><span class="o">.</span><span class="n">ParentFolder</span> <span class="o">=</span> <span class="n">BatchPath</span>
    
    <span class="c1"># Build files and run</span>
    <span class="n">x</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">n_runs</span>
    <span class="k">if</span> <span class="n">COMM</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">BuildJobFiles</span><span class="p">()</span>
    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run all trajectories using MPI parallelization</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Collect whatever has to be done in a list. Here we&#39;ll just collect a list of</span>
    <span class="c1"># numbers. Only the first rank has to do this.</span>
    <span class="k">if</span> <span class="n">COMM</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">run_dirs</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="n">_i</span><span class="p">::</span><span class="n">COMM</span><span class="o">.</span><span class="n">size</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">COMM</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>             <span class="c1"># Split into however many cores are available.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="n">jobs</span> <span class="o">=</span> <span class="n">COMM</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">jobs</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>           <span class="c1"># Scatter jobs across cores.</span>
    
    <span class="c1"># Now each rank just does its jobs and collects everything in a results list.</span>
    <span class="c1"># Make sure to not use super big objects in there as they will be pickled to be</span>
    <span class="c1"># exchanged over MPI.</span>
    <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">job</span>
        <span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">Run_sim</span><span class="p">()</span> 
    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Read and analyze results</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">COMM</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">ReadMultipleRuns</span><span class="p">()</span>
        <span class="n">x</span><span class="o">.</span><span class="n">AverageRuns</span><span class="p">()</span>
        <span class="n">x</span><span class="o">.</span><span class="n">runAvg</span><span class="o">.</span><span class="n">PlotSurfSpecVsTime</span><span class="p">()</span>
        <span class="n">x</span><span class="o">.</span><span class="n">runAvg</span><span class="o">.</span><span class="n">PlotGasSpecVsTime</span><span class="p">()</span>
        <span class="n">x</span><span class="o">.</span><span class="n">runAvg</span><span class="o">.</span><span class="n">PlotElemStepFreqs</span><span class="p">(</span><span class="n">time_norm</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This produces several .png files with statistics from the average of the trajectories.</p>
<p>Multiple_trajectories.py is usable on squidward.che.udel.edu and uses multiple job submissions to parallelize the jobs, as MPI does not allow for
jobs spread over multiple nodes (i.e. &gt; 16 cores).</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Read multiple trajectories and perform statistical analysis</span>

<span class="kn">import</span> <span class="nn">zacros_wrapper</span> <span class="kn">as</span> <span class="nn">zw</span>

<span class="sd">&#39;&#39;&#39; ------------ User input section ------------ &#39;&#39;&#39;</span>
<span class="n">zacros_exe</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/bin/zacros_ZW.x&#39;</span>
<span class="n">KMC_source</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/Github/Zacros-Wrapper/input_files/AtoB/&#39;</span>
<span class="n">BatchPath</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/test&#39;</span>
<span class="n">Product</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>
<span class="n">n_runs</span> <span class="o">=</span> <span class="mi">16</span>
<span class="sd">&#39;&#39;&#39; -------------------------------------------- &#39;&#39;&#39;</span>

<span class="c1"># Prepare template</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">Replicates</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">kmc_traj</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">KMC_source</span>
<span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">exe_file</span> <span class="o">=</span> <span class="n">zacros_exe</span>
<span class="n">x</span><span class="o">.</span><span class="n">runtemplate</span><span class="o">.</span><span class="n">ReadAllInput</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">ParentFolder</span> <span class="o">=</span> <span class="n">BatchPath</span>

<span class="c1"># Build files and run</span>
<span class="n">x</span><span class="o">.</span><span class="n">n_runs</span> <span class="o">=</span> <span class="n">n_runs</span>
<span class="n">x</span><span class="o">.</span><span class="n">BuildJobFiles</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">RunAllJobs_parallel_JobArray</span><span class="p">()</span>

<span class="c1"># Read results</span>
<span class="n">x</span><span class="o">.</span><span class="n">ReadMultipleRuns</span><span class="p">()</span>

<span class="c1"># Perform sensitivity analysis</span>
<span class="n">x</span><span class="o">.</span><span class="n">AverageRuns</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">runAvg</span><span class="o">.</span><span class="n">PlotSurfSpecVsTime</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">runAvg</span><span class="o">.</span><span class="n">PlotGasSpecVsTime</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">runAvg</span><span class="o">.</span><span class="n">PlotElemStepFreqs</span><span class="p">(</span><span class="n">time_norm</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="rate-constant-rescaling-and-steady-state-detection">
<h2>Rate constant rescaling and steady state detection<a class="headerlink" href="#rate-constant-rescaling-and-steady-state-detection" title="Permalink to this headline">¶</a></h2>
<p>Scale_SS_Main.py takes Zacros input files and runs the statistical procedure described in our publication.
Parallelization is used to run multiple trajectories simultaneously. By default, it will use MPI parallelization, but
the flag <code class="docutils literal"><span class="pre">parallel_mode</span></code> can be set to use the gridengine submission scripts on Squidward or Farber.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Read Zacros input files from a folder and then perform rate constant rescaling in a different folder</span>

<span class="kn">import</span> <span class="nn">zacros_wrapper</span> <span class="kn">as</span> <span class="nn">zw</span>

<span class="sd">&#39;&#39;&#39; ------------ User input section ------------ &#39;&#39;&#39;</span>
<span class="n">exe_file</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/bin/zacros_ZW.x&#39;</span>
<span class="n">KMC_source</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/ZacrosWrapper/sample_systems/AtoB/stiff_input&#39;</span>
<span class="n">RunPath</span> <span class="o">=</span> <span class="s1">&#39;/home/vlachos/mpnunez/ZacrosWrapper/sample_systems/AtoB/ScaledownV3&#39;</span>
<span class="n">product_spec</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>                                  <span class="c1"># product species</span>
<span class="n">number_of_runs</span> <span class="o">=</span> <span class="mi">96</span>
<span class="sd">&#39;&#39;&#39; -------------------------------------------- &#39;&#39;&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>                 <span class="c1"># Make commands safe for MPI parallelization</span>
	
    <span class="n">x</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">kmc_traj</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">KMC_source</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">gas_prod</span> <span class="o">=</span> <span class="n">product_spec</span>
    <span class="n">x</span><span class="o">.</span><span class="n">exe_file</span> <span class="o">=</span> <span class="n">exe_file</span>
    <span class="n">x</span><span class="o">.</span><span class="n">ReadAllInput</span><span class="p">()</span>
    <span class="n">final_data</span> <span class="o">=</span> <span class="n">zw</span><span class="o">.</span><span class="n">ReachSteadyStateAndRescale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">RunPath</span><span class="p">,</span> <span class="n">n_runs</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span> 
        <span class="n">n_batches</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">n_samples</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">max_iterations</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">parallel_mode</span> <span class="o">=</span> <span class="s1">&#39;MPI&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Examples</a><ul>
<li><a class="reference internal" href="#converting-dft-data-to-zacros-input-files">Converting DFT data to Zacros input files</a></li>
<li><a class="reference internal" href="#analyzing-a-single-trajectory">Analyzing a single trajectory</a></li>
<li><a class="reference internal" href="#running-and-analyzing-multiple-trajectories">Running and analyzing multiple trajectories</a></li>
<li><a class="reference internal" href="#rate-constant-rescaling-and-steady-state-detection">Rate constant rescaling and steady state detection</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Python wrapper for the Zacros kinetic Monte Carlo (KMC) code</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="compile_zacros.html"
                        title="next chapter">Compiling modified Zacros executable</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Example.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="compile_zacros.html" title="Compiling modified Zacros executable"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Python wrapper for the Zacros kinetic Monte Carlo (KMC) code"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Zacros Wrapper 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Marcel Nunez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>